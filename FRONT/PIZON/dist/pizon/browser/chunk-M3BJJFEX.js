import{a as S,c as j,f as pe}from"./chunk-VP6CFJRX.js";import{A as r,Aa as q,B as n,C as c,D as E,E as y,F as d,G as B,H as a,I as g,J as P,K as w,N as h,O as Q,U as L,V as M,W as O,Z as k,aa as H,ea as z,fa as b,ga as J,ha as K,ia as W,ja as X,k as v,ka as Y,la as Z,ma as ee,n as $,na as te,o as V,oa as ie,p as U,pa as ne,q as I,qa as re,r as R,s as o,sa as oe,t as u,ta as se,u as N,v as G,va as le,w as m,xa as ae,y as l,ya as me}from"./chunk-Y3NWWHFQ.js";var x=class i{constructor(t){this.http=t}getAll(){return this.http.get(`${S.apiUrl}/requests`)}getById(t){return this.http.get(`${S.apiUrl}/requests/${t}`)}create(t){return this.http.post(`${S.apiUrl}/requests`,t)}update(t,e){return this.http.put(`${S.apiUrl}/requests/${t}`,e)}delete(t){return this.http.delete(`${S.apiUrl}/requests/${t}`)}static \u0275fac=function(e){return new(e||i)(U(H))};static \u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})};var ge=(i,t,e)=>({"bg-warning":i,"bg-success":t,"bg-danger":e});function be(i,t){i&1&&(r(0,"span",19),a(1,"(Admin User)"),n())}function he(i,t){i&1&&(r(0,"span",20),a(1,"(Normal User)"),n())}function qe(i,t){if(i&1&&(r(0,"div"),a(1),n()),i&2){let e=t.$implicit;o(),w(" ",e.name," (x",e.quantity,") ")}}function Se(i,t){i&1&&(r(0,"div"),a(1," - "),n())}function xe(i,t){i&1&&c(0,"span",21)}function Ce(i,t){i&1&&(r(0,"span"),a(1,"Delete"),n())}function Ie(i,t){if(i&1){let e=E();r(0,"tr")(1,"td"),a(2),n(),r(3,"td"),a(4),m(5,be,2,0,"span",12)(6,he,2,0,"span",13),n(),r(7,"td"),m(8,qe,2,2,"div",8)(9,Se,2,0,"div",9),n(),r(10,"td")(11,"span",14),a(12),n()(),r(13,"td")(14,"div",15)(15,"a",16),a(16,"Edit"),n(),r(17,"button",17),y("click",function(){let p=I(e).$implicit,_=d();return R(_.deleteRequest(p.id))}),m(18,xe,1,0,"span",18)(19,Ce,2,0,"span",9),n()()()()}if(i&2){let e=t.$implicit;o(2),g(e.type),o(2),P("",e.employee==null||e.employee.user==null?null:e.employee.user.email," "),o(),l("ngIf",(e.employee==null||e.employee.user==null?null:e.employee.user.role)==="Admin"),o(),l("ngIf",(e.employee==null||e.employee.user==null?null:e.employee.user.role)==="User"),o(2),l("ngForOf",e.items),o(),l("ngIf",!e.items||e.items.length===0),o(2),l("ngClass",Q(13,ge,e.status==="Pending",e.status==="Approved",e.status==="Rejected")),o(),g(e.status),o(3),B("routerLink","edit/",e.id,""),o(2),l("disabled",e.isDeleting),o(),l("ngIf",e.isDeleting),o(),l("ngIf",!e.isDeleting)}}function Re(i,t){i&1&&(r(0,"div",24),c(1,"span",25),n())}function Ee(i,t){i&1&&(r(0,"div"),a(1," No requests found "),n())}function Fe(i,t){if(i&1&&(r(0,"tr")(1,"td",22),m(2,Re,2,0,"div",23)(3,Ee,2,0,"div",9),n()()),i&2){let e=d();o(2),l("ngIf",e.loading),o(),l("ngIf",!e.loading)}}var F=class i{constructor(t,e){this.requestService=t;this.alertService=e}requests=[];loading=!1;ngOnInit(){this.loading=!0,this.requestService.getAll().pipe(v()).subscribe({next:t=>{this.requests=t,this.loading=!1},error:t=>{this.alertService.error(t),this.loading=!1}})}deleteRequest(t){let e=this.requests.find(s=>s.id===t);e.isDeleting=!0,this.requestService.delete(t).pipe(v()).subscribe({next:()=>{this.requests=this.requests.filter(s=>s.id!==t),this.alertService.success("Request deleted successfully")},error:s=>{this.alertService.error(s),e.isDeleting=!1}})}static \u0275fac=function(e){return new(e||i)(u(x),u(j))};static \u0275cmp=N({type:i,selectors:[["app-requests-list"]],decls:24,vars:2,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped"],[2,"width","15%"],[2,"width","25%"],[2,"width","20%"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-end","mt-3"],["routerLink","add",1,"btn","btn-primary"],["class","text-danger",4,"ngIf"],["class","text-primary",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"btn-group"],[1,"btn","btn-primary",3,"routerLink"],[1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"text-danger"],[1,"text-primary"],[1,"spinner-border","spinner-border-sm"],["colspan","5",1,"text-center"],["class","d-flex justify-content-center",4,"ngIf"],[1,"d-flex","justify-content-center"],[1,"spinner-border","spinner-border-lg"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"h4",1),a(2,"REQUESTS"),n(),r(3,"div",2)(4,"div",3)(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),a(9,"Type"),n(),r(10,"th",6),a(11,"Employee"),n(),r(12,"th",6),a(13,"Items"),n(),r(14,"th",5),a(15,"Status"),n(),r(16,"th",7),a(17,"Actions"),n()()(),r(18,"tbody"),m(19,Ie,20,17,"tr",8)(20,Fe,4,2,"tr",9),n()()(),r(21,"div",10)(22,"a",11),a(23,"Add Request"),n()()()()),e&2&&(o(19),l("ngForOf",s.requests),o(),l("ngIf",!s.requests||s.requests.length===0))},dependencies:[k,L,M,O,q,me],encapsulation:2})};var T=i=>({"is-invalid":i});function Te(i,t){if(i&1&&(r(0,"option",18),a(1),n()),i&2){let e=t.$implicit;l("value",e),o(),g(e)}}function Ae(i,t){i&1&&(r(0,"div"),a(1,"Type is required"),n())}function Ne(i,t){if(i&1&&(r(0,"div",19),m(1,Ae,2,0,"div",20),n()),i&2){let e=d();o(),l("ngIf",e.f.type==null?null:e.f.type.errors.required)}}function we(i,t){if(i&1&&(r(0,"option",18),a(1),n()),i&2){let e=t.$implicit;l("value",e.id),o(),w(" ",e.user==null?null:e.user.email," (",e.id,") ")}}function Le(i,t){i&1&&(r(0,"div"),a(1,"Employee is required"),n())}function Me(i,t){if(i&1&&(r(0,"div",19),m(1,Le,2,0,"div",20),n()),i&2){let e=d();o(),l("ngIf",e.f.employeeId==null?null:e.f.employeeId.errors.required)}}function Oe(i,t){if(i&1&&(r(0,"option",18),a(1),n()),i&2){let e=t.$implicit;l("value",e),o(),g(e)}}function ke(i,t){i&1&&(r(0,"div"),a(1,"Status is required"),n())}function je(i,t){if(i&1&&(r(0,"div",19),m(1,ke,2,0,"div",20),n()),i&2){let e=d(2);o(),l("ngIf",e.f.status==null?null:e.f.status.errors.required)}}function De(i,t){if(i&1&&(r(0,"div",4)(1,"label",5),a(2,"Status"),n(),r(3,"div",6)(4,"select",21),m(5,Oe,2,2,"option",9),n(),m(6,je,2,1,"div",10),n()()),i&2){let e=d();o(4),l("ngClass",h(3,T,e.submitted&&(e.f.status==null?null:e.f.status.errors))),o(),l("ngForOf",e.statusOptions),o(),l("ngIf",e.submitted&&(e.f.status==null?null:e.f.status.errors))}}function $e(i,t){i&1&&(r(0,"div"),a(1,"Name is required"),n())}function Ve(i,t){if(i&1&&(r(0,"div",19),m(1,$e,2,0,"div",20),n()),i&2){let e,s=d().$implicit;o(),l("ngIf",s==null||(e=s.get("name"))==null?null:e.errors.required)}}function Ue(i,t){i&1&&(r(0,"div"),a(1,"Quantity is required"),n())}function Ge(i,t){i&1&&(r(0,"div"),a(1,"Quantity must be at least 1"),n())}function Be(i,t){if(i&1&&(r(0,"div",19),m(1,Ue,2,0,"div",20)(2,Ge,2,0,"div",20),n()),i&2){let e,s,p=d().$implicit;o(),l("ngIf",p==null||(e=p.get("quantity"))==null?null:e.errors.required),o(),l("ngIf",p==null||(s=p.get("quantity"))==null?null:s.errors.min)}}function Pe(i,t){if(i&1){let e=E();r(0,"tr",32)(1,"td"),c(2,"input",33),m(3,Ve,2,1,"div",10),n(),r(4,"td"),c(5,"input",34),m(6,Be,3,2,"div",10),n(),r(7,"td",35)(8,"button",36),y("click",function(){let p=I(e).index,_=d(3);return R(_.removeItem(p))}),a(9,"Remove"),n()()()}if(i&2){let e,s,p,_,f=t.$implicit,ce=t.index,A=d(3);l("formGroupName",ce),o(2),l("ngClass",h(5,T,A.submitted&&(f==null||(e=f.get("name"))==null?null:e.errors))),o(),l("ngIf",A.submitted&&(f==null||(s=f.get("name"))==null?null:s.errors)),o(2),l("ngClass",h(7,T,A.submitted&&(f==null||(p=f.get("quantity"))==null?null:p.errors))),o(),l("ngIf",A.submitted&&(f==null||(_=f.get("quantity"))==null?null:_.errors))}}function Qe(i,t){if(i&1&&(r(0,"tbody",30),m(1,Pe,10,9,"tr",31),n()),i&2){let e=d(2);o(),l("ngForOf",e.itemsArray.controls)}}function He(i,t){if(i&1){let e=E();r(0,"div",22)(1,"label",23),a(2,"Items"),n(),r(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),a(8,"Name"),n(),r(9,"th",26),a(10,"Quantity"),n(),c(11,"th",27),n()(),m(12,Qe,2,1,"tbody",28),n()(),r(13,"div",29)(14,"button",17),y("click",function(){I(e);let p=d();return R(p.addItem())}),a(15,"Add Item"),n()()()}if(i&2){let e=d();o(12),l("ngIf",e.itemsArray.controls.length>0)}}function ze(i,t){i&1&&c(0,"span",37)}var C=class i{constructor(t,e,s,p,_,f){this.formBuilder=t;this.route=e;this.router=s;this.requestService=p;this.employeeService=_;this.alertService=f}form;id;isAddMode;loading=!1;submitted=!1;employees=[];requestTypes=["Equipment","Resources","Leave"];statusOptions=["Pending","Approved","Rejected"];itemRequiredTypes=["Equipment","Resources"];ngOnInit(){this.id=Number(this.route.snapshot.params.id),this.isAddMode=!this.id,this.employeeService.getAll().pipe(v()).subscribe({next:t=>this.employees=t,error:t=>this.alertService.error(t)}),this.form=this.formBuilder.group({type:["",b.required],employeeId:["",b.required],status:[{value:"Pending",disabled:this.isAddMode},b.required],items:this.formBuilder.array([])}),this.form.get("type")?.valueChanges.subscribe(t=>this.clearItemsIfNecessary(t)),this.isAddMode||this.loadRequestData()}clearItemsIfNecessary(t){this.itemRequiredTypes.includes(t)||this.itemsArray.clear()}loadRequestData(){this.loading=!0,this.requestService.getById(this.id).pipe(v()).subscribe({next:t=>{this.form.patchValue({type:t.type,employeeId:t.employeeId,status:t.status}),this.itemsArray.clear(),this.itemRequiredTypes.includes(t.type)&&t.items&&t.items.forEach(e=>this.addItem(e)),this.loading=!1},error:t=>{this.alertService.error(t),this.loading=!1}})}showItemsSection(){return this.itemRequiredTypes.includes(this.form.value.type)}get f(){return this.form.controls}get itemsArray(){return this.form.get("items")}addItem(t={name:"",quantity:1}){this.itemsArray.push(this.formBuilder.group({name:[t.name,b.required],quantity:[t.quantity,[b.required,b.min(1)]]}))}removeItem(t){this.itemsArray.removeAt(t)}onSubmit(){if(this.submitted=!0,this.alertService.clear(),this.form.invalid)return;let t=this.form.value.type;if(this.itemRequiredTypes.includes(t)&&this.itemsArray.length===0){this.alertService.error(`Please add at least one item for the ${t.toLowerCase()} request`);return}this.loading=!0,this.isAddMode?this.createRequest():this.updateRequest()}onCancel(){this.router.navigate([this.isAddMode?"../":"../../"],{relativeTo:this.route})}createRequest(){this.requestService.create(this.form.getRawValue()).pipe(v()).subscribe({next:()=>{this.alertService.success("Request added successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}updateRequest(){this.requestService.update(this.id,this.form.getRawValue()).pipe(v()).subscribe({next:()=>{this.alertService.success("Request updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}static \u0275fac=function(e){return new(e||i)(u(oe),u(le),u(ae),u(x),u(pe),u(j))};static \u0275cmp=N({type:i,selectors:[["app-requests-form"]],decls:29,vars:16,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3","row"],[1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["formControlName","type",1,"form-select",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formControlName","employeeId",1,"form-select",3,"ngClass"],["class","mb-3 row",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"d-flex","justify-content-center","mt-4"],[1,"btn","btn-primary","me-2",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],["formControlName","status",1,"form-select",3,"ngClass"],[1,"mb-4"],[1,"col-form-label"],[1,"table-responsive"],[1,"table","table-borderless"],[2,"width","45%"],[2,"width","10%"],["formArrayName","items",4,"ngIf"],[1,"d-flex","justify-content-start","mb-3"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["type","text","formControlName","name",1,"form-control",3,"ngClass"],["type","number","formControlName","quantity",1,"form-control",3,"ngClass"],[1,"text-center"],["type","button",1,"btn","btn-danger",3,"click"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"h4",1),a(2),n(),r(3,"div",2)(4,"form",3),y("ngSubmit",function(){return s.onSubmit()}),r(5,"div",4)(6,"label",5),a(7,"Type"),n(),r(8,"div",6)(9,"select",7),c(10,"option",8),m(11,Te,2,2,"option",9),n(),m(12,Ne,2,1,"div",10),n()(),r(13,"div",4)(14,"label",5),a(15,"Employee"),n(),r(16,"div",6)(17,"select",11),c(18,"option",8),m(19,we,2,3,"option",9),n(),m(20,Me,2,1,"div",10),n()(),m(21,De,7,5,"div",12)(22,He,16,1,"div",13),r(23,"div",14)(24,"button",15),m(25,ze,1,0,"span",16),a(26," Save "),n(),r(27,"button",17),y("click",function(){return s.onCancel()}),a(28,"Cancel"),n()()()()()),e&2&&(o(2),g(s.isAddMode?"ADD REQUEST":"EDIT REQUEST"),o(2),l("formGroup",s.form),o(5),l("ngClass",h(12,T,s.submitted&&(s.f.type==null?null:s.f.type.errors))),o(2),l("ngForOf",s.requestTypes),o(),l("ngIf",s.submitted&&(s.f.type==null?null:s.f.type.errors)),o(5),l("ngClass",h(14,T,s.submitted&&(s.f.employeeId==null?null:s.f.employeeId.errors))),o(2),l("ngForOf",s.employees),o(),l("ngIf",s.submitted&&(s.f.employeeId==null?null:s.f.employeeId.errors)),o(),l("ngIf",!s.isAddMode),o(),l("ngIf",s.showItemsSection()),o(2),l("disabled",s.loading),o(),l("ngIf",s.loading))},dependencies:[k,L,M,O,se,W,ne,re,z,X,ie,J,K,Y,te,Z,ee,q],encapsulation:2})};var Je=[{path:"",component:F},{path:"add",component:C},{path:"edit/:id",component:C}],ue=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=G({type:i});static \u0275inj=V({imports:[q.forChild(Je),F,C]})};export{ue as RequestsModule};
